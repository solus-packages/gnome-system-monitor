From ecd0a3d3d6e12c12325433aaea720febae2d8db3 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Mon, 12 Apr 2021 04:53:31 +0300
Subject: [PATCH 1/1] Revert use of libhandy

---
 data/interface.ui   |  150 +++---
 data/preferences.ui | 1129 +++++++++++++++++++++++++++++++------------
 meson.build         |    1 -
 src/application.cpp |    3 -
 src/application.h   |    3 +-
 src/interface.cpp   |   19 +-
 src/meson.build     |    1 -
 src/prefsdialog.cpp |   89 ++--
 8 files changed, 946 insertions(+), 449 deletions(-)

diff --git a/data/interface.ui b/data/interface.ui
index 0e611d2b..48e453d2 100644
--- a/data/interface.ui
+++ b/data/interface.ui
@@ -1,103 +1,91 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <interface>
   <!-- interface-requires gtk+ 3.12 -->
-  <object class="HdyApplicationWindow" id="main_window">
+  <object class="GtkApplicationWindow" id="main_window">
     <property name="can-focus">False</property>
     <property name="title" translatable="yes">System Monitor</property>
     <property name="default-width">440</property>
     <property name="default-height">495</property>
     <property name="icon-name">org.gnome.SystemMonitor</property>
-    <child>
-      <object class="GtkBox" id="main_box">
+    <child type="titlebar">
+      <object class="GtkHeaderBar" id="header_bar">
         <property name="visible">True</property>
-        <property name="can-focus">False</property>
-        <property name="orientation">vertical</property>
-        <property name="width-request">620</property>
-        <property name="height-request">480</property>
+        <property name="show-close-button">True</property>
+        <style>
+          <class name="titlebar"/>
+        </style>
+        <child type="title">
+          <object class="GtkStackSwitcher" id="stack_switcher">
+            <property name="visible">True</property>
+            <property name="stack">stack</property>
+          </object>
+        </child>
         <child>
-          <object class="HdyHeaderBar" id="header_bar">
+          <object class="GtkMenuButton" id="process_menu_button">
             <property name="visible">True</property>
-            <property name="show-close-button">True</property>
+            <property name="can-focus">True</property>
+            <property name="use-popover">True</property>
+            <property name="valign">center</property>
+            <property name="halign">end</property>
+            <property name="direction">none</property>
+            <accelerator key="F10" signal="clicked"/>
             <style>
-              <class name="titlebar"/>
+              <class name="title-button"/>
+            </style>
+          </object>
+          <packing>
+            <property name="pack-type">end</property>
+          </packing>
+        </child>
+        <child>
+          <object class="GtkMenuButton" id="window_menu_button">
+            <property name="visible">True</property>
+            <property name="can-focus">True</property>
+            <property name="use-popover">True</property>
+            <property name="valign">center</property>
+            <property name="halign">end</property>
+            <property name="direction">none</property>
+            <accelerator key="F10" signal="clicked"/>
+            <style>
+              <class name="title-button"/>
+            </style>
+          </object>
+          <packing>
+            <property name="pack-type">end</property>
+          </packing>
+        </child>
+        <child>
+          <object class="GtkToggleButton" id="search_button">
+            <property name="visible">True</property>
+            <property name="active">False</property>
+            <property name="valign">center</property>
+            <property name="margin-start">6</property>
+            <property name="action-name">win.search</property>
+            <property name="action-target">@b false</property>
+            <style>
+              <class name="title-button"/>
             </style>
-            <child type="title">
-              <object class="HdyViewSwitcher" id="view_switcher">
-                <property name="visible">True</property>
-                <property name="stack">stack</property>
-              </object>
-            </child>
             <child>
-              <object class="GtkBox" id="button_box">
+              <object class="GtkImage" id="search_image">
                 <property name="visible">True</property>
-                <property name="can-focus">False</property>
-                <property name="orientation">horizontal</property>
-                <property name="width-request">90</property>
-                <property name="spacing">6</property>
-                <child>
-                  <object class="GtkMenuButton" id="process_menu_button">
-                    <property name="visible">True</property>
-                    <property name="can-focus">True</property>
-                    <property name="use-popover">True</property>
-                    <property name="valign">center</property>
-                    <property name="halign">end</property>
-                    <property name="direction">none</property>
-                    <accelerator key="F10" signal="clicked"/>
-                    <style>
-                      <class name="title-button"/>
-                    </style>
-                  </object>
-                  <packing>
-                    <property name="pack-type">end</property>
-                  </packing>
-                </child>
-                <child>
-                  <object class="GtkMenuButton" id="window_menu_button">
-                    <property name="visible">True</property>
-                    <property name="can-focus">True</property>
-                    <property name="use-popover">True</property>
-                    <property name="valign">center</property>
-                    <property name="halign">end</property>
-                    <property name="direction">none</property>
-                    <accelerator key="F10" signal="clicked"/>
-                    <style>
-                      <class name="title-button"/>
-                    </style>
-                  </object>
-                  <packing>
-                    <property name="pack-type">end</property>
-                  </packing>
-                </child>
-                <child>
-                  <object class="GtkToggleButton" id="search_button">
-                    <property name="visible">True</property>
-                    <property name="active">False</property>
-                    <property name="valign">center</property>
-                    <property name="margin-start">6</property>
-                    <property name="action-name">win.search</property>
-                    <property name="action-target">@b false</property>
-                    <style>
-                      <class name="title-button"/>
-                    </style>
-                    <child>
-                      <object class="GtkImage" id="search_image">
-                        <property name="visible">True</property>
-                        <property name="icon-size">1</property>
-                        <property name="icon-name">edit-find-symbolic</property>
-                      </object>
-                    </child>
-                  </object>
-                  <packing>
-                    <property name="pack-type">end</property>
-                  </packing>
-                </child>
+                <property name="icon-size">1</property>
+                <property name="icon-name">edit-find-symbolic</property>
               </object>
-              <packing>
-                <property name="pack-type">end</property>
-              </packing>
             </child>
           </object>
+          <packing>
+            <property name="pack-type">end</property>
+          </packing>
         </child>
+      </object>
+    </child>
+    <child>
+      <object class="GtkBox" id="main_box">
+        <property name="visible">True</property>
+        <property name="can-focus">False</property>
+        <property name="orientation">vertical</property>
+        <property name="width-request">620</property>
+        <property name="height-request">480</property>
         <child>
           <object class="GtkStack" id="stack">
             <property name="visible">True</property>
diff --git a/data/preferences.ui b/data/preferences.ui
index 6e7256a5..aeef922c 100644
--- a/data/preferences.ui
+++ b/data/preferences.ui
@@ -1,359 +1,846 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <interface>
   <!-- interface-requires gtk+ 3.0 -->
-  <object class="HdyPreferencesWindow" id="preferences_dialog">
-    <property name="visible">True</property>
+  <object class="GtkDialog" id="preferences_dialog">
     <property name="can_focus">False</property>
+    <property name="use_header_bar">1</property>
+    <property name="border_width">5</property>
     <property name="title" translatable="yes">Preferences</property>
-    <property name="default_width">700</property>
-    <property name="default_height">700</property>
+    <property name="default_width">400</property>
+    <property name="default_height">495</property>
     <property name="destroy_with_parent">True</property>
-    <child>
-      <object class="HdyPreferencesPage">
-        <property name="visible">True</property>
-        <property name="title" translatable="yes">Processes</property>
-        <property name="icon-name">view-list-symbolic</property>
+    <property name="type_hint">dialog</property>
+    <child internal-child="vbox">
+      <object class="GtkBox" id="dialog_layout">
+        <property name="can_focus">False</property>
+        <property name="orientation">vertical</property>
+        <property name="spacing">2</property>
         <child>
-          <object class="HdyPreferencesGroup">
+          <object class="GtkGrid" id="content_grid">
             <property name="visible">True</property>
-            <property name="title" translatable="yes">Behavior</property>
+            <property name="can_focus">False</property>
+            <property name="orientation">vertical</property>
+            <property name="column_spacing">2</property>
             <child>
-              <object class="HdyActionRow">
+              <object class="GtkNotebook" id="notebook">
                 <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Update Interval in Seconds</property>
-                <property name="activatable-widget">processes_interval_spinner</property>
+                <property name="can_focus">True</property>
+                <property name="hexpand">True</property>
+                <property name="vexpand">True</property>
+                <property name="border_width">5</property>
                 <child>
-                  <object class="GtkSpinButton" id="processes_interval_spinner">
+                  <object class="GtkGrid" id="processes_tab_content">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="valign">center</property>
-                    <property name="invisible_char">•</property>
-                    <property name="climb_rate">1</property>
-                    <property name="digits">2</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Enable _Smooth Refresh</property>
-                <property name="activatable-widget">smooth_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="smooth_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Alert Before Ending or _Killing Processes</property>
-                <property name="activatable-widget">check_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="check_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Divide CPU Usage by CPU Count</property>
-                <property name="activatable-widget">solaris_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="solaris_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Show Memory in IEC</property>
-                <property name="activatable-widget">proc_mem_in_iec_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="proc_mem_in_iec_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-          </object>
-        </child>
-        <child>
-          <object class="HdyPreferencesGroup">
-            <property name="visible">True</property>
-            <property name="title" translatable="yes">Information Fields</property>
-            <property name="description" translatable="yes">Process information shown in list:</property>
-            <child>
-              <object class="GtkFrame">
-                <property name="visible">True</property>
-                <child>
-                  <object class="GtkTreeView" id="proctree_columns">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="headers_visible">False</property>
-                    <property name="enable_search">False</property>
-                    <child internal-child="selection">
-                      <object class="GtkTreeSelection" id="processes-columns-selection"/>
-                    </child>
-                  </object>
-                </child>
-              </object>
-            </child>
-          </object>
-        </child>
-      </object>
-    </child>
-    <child>
-      <object class="HdyPreferencesPage">
-        <property name="visible">True</property>
-        <property name="title" translatable="yes">Resources</property>
-        <property name="icon-name">speedometer-symbolic</property>
-        <child>
-          <object class="HdyPreferencesGroup">
-            <property name="visible">True</property>
-            <property name="title" translatable="yes">Graphs</property>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Update Interval in Seconds</property>
-                <property name="activatable-widget">resources_interval_spinner</property>
-                <child>
-                  <object class="GtkSpinButton" id="resources_interval_spinner">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="valign">center</property>
-                    <property name="invisible_char">•</property>
-                    <property name="climb_rate">1</property>
-                    <property name="digits">2</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Chart Data Points</property>
-                <child>
-                  <object class="GtkScale" id="graph_data_points_scale">
+                    <property name="can_focus">False</property>
                     <property name="hexpand">True</property>
-                    <property name="orientation">horizontal</property>
-                    <property name="visible">True</property>
-                    <property name="draw-value">True</property>
-                    <property name="value-pos">right</property>
-                    <property name="digits">0</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Draw CPU Chart as Stacked Area Chart</property>
-                <property name="activatable-widget">draw_stacked_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="draw_stacked_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Draw Charts as S_mooth Graphs</property>
-                <property name="activatable-widget">draw_smooth_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="draw_smooth_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Show Memory and Swap in IEC</property>
-                <property name="activatable-widget">res_mem_in_iec_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="res_mem_in_iec_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Show Memory in Logarithmic Scale</property>
-                <property name="activatable-widget">logarithmic_scale_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="logarithmic_scale_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Show Network Speed in Bits</property>
-                <property name="activatable-widget">bits_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="bits_switch">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
+                    <property name="vexpand">True</property>
+                    <property name="border_width">12</property>
+                    <property name="orientation">vertical</property>
+                    <property name="row_spacing">18</property>
+                    <child>
+                      <object class="GtkGrid" id="processes_behavior">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="row_spacing">6</property>
+                        <child>
+                          <object class="GtkLabel" id="processes_behavior_label">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="hexpand">True</property>
+                            <property name="halign">start</property>
+                            <property name="label" translatable="yes">Behavior</property>
+                            <property name="justify">fill</property>
+                            <property name="ellipsize">end</property>
+                            <property name="single_line_mode">True</property>
+                            <attributes>
+                              <attribute name="weight" value="bold"/>
+                            </attributes>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">0</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkGrid" id="processes_behavior_section">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="margin_start">12</property>
+                            <property name="hexpand">True</property>
+                            <property name="row_spacing">6</property>
+                            <child>
+                              <object class="GtkGrid" id="update_interval_grid">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="column_spacing">12</property>
+                                <child>
+                                  <object class="GtkLabel" id="processes_interval_label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">_Update interval in seconds:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">processes_interval_spinner</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">0</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkSpinButton" id="processes_interval_spinner">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="invisible_char">•</property>
+                                    <property name="climb_rate">1</property>
+                                    <property name="digits">2</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">0</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="smooth_button">
+                                <property name="label" translatable="yes">Enable _smooth refresh</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">1</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="check_button">
+                                <property name="label" translatable="yes">Alert before ending or _killing processes</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">2</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="solaris_button">
+                                <property name="label" translatable="yes">_Divide CPU usage by CPU count</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">3</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="proc_mem_in_iec_button">
+                                <property name="label" translatable="yes">Show memory in IEC</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="halign">start</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">4</property>
+                              </packing>
+                            </child>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">1</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                        <property name="width">1</property>
+                        <property name="height">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkGrid" id="processes_fields">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="vexpand">True</property>
+                        <property name="row_spacing">6</property>
+                        <child>
+                          <object class="GtkLabel" id="processes_fields_label">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="hexpand">True</property>
+                            <property name="halign">start</property>
+                            <property name="label" translatable="yes">Information Fields</property>
+                            <property name="justify">fill</property>
+                            <property name="ellipsize">end</property>
+                            <property name="single_line_mode">True</property>
+                            <attributes>
+                              <attribute name="weight" value="bold"/>
+                            </attributes>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">0</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkGrid" id="processes_fields_grid">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="margin_start">12</property>
+                            <property name="hexpand">True</property>
+                            <property name="vexpand">True</property>
+                            <property name="orientation">vertical</property>
+                            <property name="row_spacing">6</property>
+                            <child>
+                              <object class="GtkLabel" id="processes_fields_table_label">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="halign">start</property>
+                                <property name="label" translatable="yes">Process i_nformation shown in list:</property>
+                                <property name="use_underline">True</property>
+                                <property name="mnemonic_widget">proctree_columns</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">0</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkScrolledWindow" id="processes_scrolled">
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="hexpand">True</property>
+                                <property name="vexpand">True</property>
+                                <property name="shadow_type">in</property>
+                                <child>
+                                  <object class="GtkTreeView" id="proctree_columns">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="headers_visible">False</property>
+                                    <property name="enable_search">False</property>
+                                    <child internal-child="selection">
+                                      <object class="GtkTreeSelection" id="processes-columns-selection"/>
+                                    </child>
+                                  </object>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">1</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">1</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                        <property name="width">1</property>
+                        <property name="height">1</property>
+                      </packing>
+                    </child>
                   </object>
                 </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Set Network Totals _Unit Separately</property>
-                <property name="activatable-widget">bits_unit_switch</property>
-                <child>
-                  <object class="GtkSwitch" id="bits_unit_switch">
+                <child type="tab">
+                  <object class="GtkLabel" id="processes_tab_label">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
+                    <property name="can_focus">False</property>
+                    <property name="label" translatable="yes">Processes</property>
                   </object>
+                  <packing>
+                    <property name="tab_fill">False</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Show Network _Totals in Bits</property>
-                <property name="activatable-widget">bits_total_switch</property>
-                <property name="sensitive" bind-source="bits_unit_switch" bind-property="active" bind-flags="sync-create"/>
                 <child>
-                  <object class="GtkSwitch" id="bits_total_switch">
+                  <object class="GtkGrid" id="resources_tab_content">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
+                    <property name="can_focus">False</property>
+                    <property name="hexpand">True</property>
+                    <property name="vexpand">True</property>
+                    <property name="border_width">12</property>
+                    <property name="orientation">vertical</property>
+                    <property name="row_spacing">18</property>
+                    <child>
+                      <object class="GtkGrid" id="resources_graphs">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="row_spacing">6</property>
+                        <child>
+                          <object class="GtkLabel" id="resources_graphs_label">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="hexpand">True</property>
+                            <property name="halign">start</property>
+                            <property name="label" translatable="yes">Graphs</property>
+                            <property name="justify">fill</property>
+                            <property name="ellipsize">end</property>
+                            <property name="single_line_mode">True</property>
+                            <attributes>
+                              <attribute name="weight" value="bold"/>
+                            </attributes>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">0</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkGrid" id="resources_graphs_section">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="margin_start">12</property>
+                            <property name="hexpand">True</property>
+                            <property name="vexpand">True</property>
+                            <property name="row_spacing">6</property>
+                            <child>
+                              <object class="GtkGrid" id="resources_update_interval">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="column_spacing">12</property>
+                                <child>
+                                  <object class="GtkLabel" id="resources_interval_label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">_Update interval in seconds:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">resources_interval_spinner</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">0</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkSpinButton" id="resources_interval_spinner">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="invisible_char">•</property>
+                                    <property name="climb_rate">1</property>
+                                    <property name="digits">2</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">0</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkGrid" id="graph_data_points">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="column_spacing">12</property>
+                                <child>
+                                  <object class="GtkLabel" id="graph_data_points_label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">_Chart data points:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">graph_data_points_scale</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">0</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkScale" id="graph_data_points_scale">
+                                    <property name="orientation">horizontal</property>
+                                    <property name="visible">True</property>
+                                    <property name="draw-value">True</property>
+                                    <property name="value-pos">right</property>
+                                    <property name="digits">0</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">18</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">1</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="draw_stacked_button">
+                                <property name="label" translatable="yes">_Draw CPU chart as stacked area chart</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">2</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="draw_smooth_button">
+                                <property name="label" translatable="yes">Draw charts as s_mooth graphs</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">3</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="res_mem_in_iec_button">
+                                <property name="label" translatable="yes">Show memory and swap in IEC</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="halign">start</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">4</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="logarithmic_scale_button">
+                                <property name="label" translatable="yes">Show memory in logarithmic scale</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">5</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="bits_button">
+                                <property name="label" translatable="yes">_Show network speed in bits</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">6</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="bits_unit_button">
+                                <property name="label" translatable="yes">Set network totals _unit separately</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                                <signal name="toggled" handler="on_bits_unit_button_toggled" object="bits_total_button" swapped="no"/>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">7</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="bits_total_button">
+                                <property name="label" translatable="yes">Show network _totals in bits</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">8</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">1</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                        <property name="width">1</property>
+                        <property name="height">1</property>
+                      </packing>
+                    </child>
                   </object>
+                  <packing>
+                    <property name="position">1</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-          </object>
-        </child>
-      </object>
-    </child>
-    <child>
-      <object class="HdyPreferencesPage">
-        <property name="visible">True</property>
-        <property name="title" translatable="yes">File Systems</property>
-        <property name="icon-name">drive-harddisk-symbolic</property>
-        <child>
-          <object class="HdyPreferencesGroup">
-            <property name="visible">True</property>
-            <property name="title" translatable="yes">Behavior</property>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">_Update Interval in Seconds</property>
-                <property name="activatable-widget">devices_interval_spinner</property>
-                <child>
-                  <object class="GtkSpinButton" id="devices_interval_spinner">
+                <child type="tab">
+                  <object class="GtkLabel" id="resources_tab_label">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="valign">center</property>
-                    <property name="invisible_char">•</property>
-                    <property name="climb_rate">1</property>
-                    <property name="digits">2</property>
+                    <property name="can_focus">False</property>
+                    <property name="label" translatable="yes">Resources</property>
                   </object>
+                  <packing>
+                    <property name="position">1</property>
+                    <property name="tab_fill">False</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="use-underline">True</property>
-                <property name="title" translatable="yes">Show _All File Systems</property>
-                <property name="activatable-widget">all_devices_check</property>
                 <child>
-                  <object class="GtkSwitch" id="all_devices_check">
+                  <object class="GtkGrid" id="devices_tab_content">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="receives_default">False</property>
-                    <property name="valign">center</property>
+                    <property name="can_focus">False</property>
+                    <property name="hexpand">True</property>
+                    <property name="vexpand">True</property>
+                    <property name="border_width">12</property>
+                    <property name="orientation">vertical</property>
+                    <property name="row_spacing">18</property>
+                    <child>
+                      <object class="GtkGrid" id="devices_behavior">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="row_spacing">6</property>
+                        <child>
+                          <object class="GtkLabel" id="devices_behavior_label">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="hexpand">True</property>
+                            <property name="halign">start</property>
+                            <property name="label" translatable="yes">Behavior</property>
+                            <property name="justify">fill</property>
+                            <property name="ellipsize">end</property>
+                            <property name="single_line_mode">True</property>
+                            <attributes>
+                              <attribute name="weight" value="bold"/>
+                            </attributes>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">0</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkGrid" id="devices_behavior_section">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="margin_start">12</property>
+                            <property name="hexpand">True</property>
+                            <property name="row_spacing">6</property>
+                            <child>
+                              <object class="GtkGrid" id="devices_interval_grid">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="column_spacing">12</property>
+                                <child>
+                                  <object class="GtkLabel" id="devices_interval_label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">_Update interval in seconds:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">devices_interval_spinner</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">0</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkSpinButton" id="devices_interval_spinner">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="invisible_char">•</property>
+                                    <property name="climb_rate">1</property>
+                                    <property name="digits">2</property>
+                                  </object>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="top_attach">0</property>
+                                    <property name="width">1</property>
+                                    <property name="height">1</property>
+                                  </packing>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">0</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="all_devices_check">
+                                <property name="label" translatable="yes">Show _all file systems</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="hexpand">True</property>
+                                <property name="use_underline">True</property>
+                                <property name="halign">start</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">1</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">1</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                        <property name="width">1</property>
+                        <property name="height">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkGrid" id="devices_fields">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="vexpand">True</property>
+                        <property name="row_spacing">6</property>
+                        <child>
+                          <object class="GtkLabel" id="devices_fields_label">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="hexpand">True</property>
+                            <property name="halign">start</property>
+                            <property name="label" translatable="yes">Information Fields</property>
+                            <property name="justify">fill</property>
+                            <property name="ellipsize">end</property>
+                            <property name="single_line_mode">True</property>
+                            <attributes>
+                              <attribute name="weight" value="bold"/>
+                            </attributes>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">0</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkGrid" id="devices_fields_grid">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="margin_start">12</property>
+                            <property name="hexpand">True</property>
+                            <property name="vexpand">True</property>
+                            <property name="orientation">vertical</property>
+                            <property name="row_spacing">6</property>
+                            <child>
+                              <object class="GtkLabel" id="devices_fields_table_label">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="halign">start</property>
+                                <property name="label" translatable="yes">File system i_nformation shown in list:</property>
+                                <property name="use_underline">True</property>
+                                <property name="mnemonic_widget">disktreenew_columns</property>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">0</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkScrolledWindow" id="devices_scrolled">
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="hexpand">True</property>
+                                <property name="vexpand">True</property>
+                                <property name="shadow_type">in</property>
+                                <child>
+                                  <object class="GtkTreeView" id="disktreenew_columns">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="headers_visible">False</property>
+                                    <property name="enable_search">False</property>
+                                    <child internal-child="selection">
+                                      <object class="GtkTreeSelection" id="devices-treeview-selection"/>
+                                    </child>
+                                  </object>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="left_attach">0</property>
+                                <property name="top_attach">1</property>
+                                <property name="width">1</property>
+                                <property name="height">1</property>
+                              </packing>
+                            </child>
+                          </object>
+                          <packing>
+                            <property name="left_attach">0</property>
+                            <property name="top_attach">1</property>
+                            <property name="width">1</property>
+                            <property name="height">1</property>
+                          </packing>
+                        </child>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                        <property name="width">1</property>
+                        <property name="height">1</property>
+                      </packing>
+                    </child>
                   </object>
+                  <packing>
+                    <property name="position">2</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-          </object>
-        </child>
-        <child>
-          <object class="HdyPreferencesGroup">
-            <property name="visible">True</property>
-            <property name="title" translatable="yes">Information Fields</property>
-            <property name="description" translatable="yes">File system information shown in list</property>
-            <child>
-              <object class="GtkFrame">
-                <property name="visible">True</property>
-                <child>
-                  <object class="GtkTreeView" id="disktreenew_columns">
+                <child type="tab">
+                  <object class="GtkLabel" id="file_systems_tab_label">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="headers_visible">False</property>
-                    <property name="enable_search">False</property>
-                    <child internal-child="selection">
-                      <object class="GtkTreeSelection" id="devices-treeview-selection"/>
-                    </child>
+                    <property name="can_focus">False</property>
+                    <property name="label" translatable="yes">File Systems</property>
                   </object>
+                  <packing>
+                    <property name="position">2</property>
+                    <property name="tab_fill">False</property>
+                  </packing>
                 </child>
               </object>
+              <packing>
+                <property name="left_attach">0</property>
+                <property name="top_attach">0</property>
+                <property name="width">1</property>
+                <property name="height">1</property>
+              </packing>
             </child>
           </object>
+          <packing>
+            <property name="expand">True</property>
+            <property name="fill">True</property>
+            <property name="position">1</property>
+          </packing>
         </child>
       </object>
     </child>
diff --git a/meson.build b/meson.build
index 58c91e01..72dd858d 100644
--- a/meson.build
+++ b/meson.build
@@ -48,7 +48,6 @@ gtk3    = dependency('gtk+-3.0',    version: '>=3.22.0')
 gtkmm   = dependency('gtkmm-3.0',   version: '>=3.3.18')
 atkmm   = dependency('atkmm-1.6',   version: '>=2.28')
 libgtop = dependency('libgtop-2.0', version: '>=2.37.0')
-libhandy = dependency('libhandy-1',  version: '>=1.0.0')
 librsvg = dependency('librsvg-2.0', version: '>=2.35')
 libxml  = dependency('libxml-2.0',  version: '>=2.0')
 
diff --git a/src/application.cpp b/src/application.cpp
index e66408a1..72e852e0 100644
--- a/src/application.cpp
+++ b/src/application.cpp
@@ -6,7 +6,6 @@
 #include <glibtop/close.h>
 #include <glibtop/cpu.h>
 #include <glibtop/sysinfo.h>
-#include <libhandy-1/handy.h>
 #include <signal.h>
 #include <stdlib.h>
 
@@ -472,8 +471,6 @@ void GsmApplication::on_startup()
 {
     Gtk::Application::on_startup();
 
-    hdy_init();
-
     load_resources ();
 
     Glib::RefPtr<Gio::SimpleAction> action;
diff --git a/src/application.h b/src/application.h
index 8f1c6224..8961c5c4 100644
--- a/src/application.h
+++ b/src/application.h
@@ -4,7 +4,6 @@
 
 #include <gtkmm.h>
 #include <glibtop/cpu.h>
-#include <libhandy-1/handy.h>
 
 #include <algorithm>
 
@@ -240,7 +239,7 @@ public:
     PrettyTable      *pretty_table;
 
     Glib::RefPtr<Gio::Settings> settings;
-    HdyApplicationWindow *main_window;
+    GtkApplicationWindow *main_window;
 
     unsigned         frequency;
 
diff --git a/src/interface.cpp b/src/interface.cpp
index 65e52682..272b5f8a 100644
--- a/src/interface.cpp
+++ b/src/interface.cpp
@@ -22,7 +22,6 @@
 
 #include <glib/gi18n.h>
 #include <gtk/gtk.h>
-#include <libhandy-1/handy.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
@@ -431,7 +430,7 @@ static void
 on_activate_keyboard_shortcuts (GSimpleAction *, GVariant *, gpointer data)
 {
     GsmApplication *app = (GsmApplication *) data;
-    gtk_widget_show (GTK_WIDGET (gtk_application_window_get_help_overlay (GTK_APPLICATION_WINDOW (app->main_window))));
+    gtk_widget_show (GTK_WIDGET (gtk_application_window_get_help_overlay (app->main_window)));
 }
 
 static void
@@ -691,7 +690,7 @@ cb_main_window_state_changed (GtkWidget *window, GdkEventWindowState *event, gpo
 void
 create_main_window (GsmApplication *app)
 {
-    HdyApplicationWindow *main_window;
+    GtkApplicationWindow *main_window;
     GtkStack *stack;
     GMenuModel *window_menu_model;
     GMenuModel *process_menu_model;
@@ -706,14 +705,24 @@ create_main_window (GsmApplication *app)
     gtk_builder_add_from_resource (builder, "/org/gnome/gnome-system-monitor/data/menus.ui", NULL);
     gtk_builder_add_from_resource (builder, "/org/gnome/gnome-system-monitor/gtk/help-overlay.ui", NULL);
 
-    main_window = HDY_APPLICATION_WINDOW (gtk_builder_get_object (builder, "main_window"));
+    main_window = GTK_APPLICATION_WINDOW (gtk_builder_get_object (builder, "main_window"));
     gtk_window_set_application (GTK_WINDOW (main_window), app->gobj());
     gtk_widget_set_name (GTK_WIDGET (main_window), "gnome-system-monitor");
     app->main_window = main_window;
 
-    gtk_application_window_set_help_overlay (GTK_APPLICATION_WINDOW (app->main_window),
+    gtk_application_window_set_help_overlay (app->main_window, 
                                              GTK_SHORTCUTS_WINDOW (gtk_builder_get_object (builder, "help_overlay")));
 
+    GtkBox *mainbox;
+    GtkHeaderBar *headerbar;
+
+    mainbox = GTK_BOX (gtk_builder_get_object (builder, "main_box"));
+    headerbar = GTK_HEADER_BAR (gtk_builder_get_object (builder, "header_bar"));
+    gtk_style_context_remove_class (gtk_widget_get_style_context (GTK_WIDGET (headerbar)), "titlebar");
+    gtk_window_set_titlebar (GTK_WINDOW (main_window), NULL);
+    gtk_header_bar_set_show_close_button (headerbar, FALSE);
+    gtk_box_pack_start (mainbox, GTK_WIDGET (headerbar), FALSE, FALSE, 0);
+
     g_settings_get (app->settings->gobj(), GSM_SETTING_WINDOW_STATE, "(iiii)",
                     &width, &height, &xpos, &ypos);
     
diff --git a/src/meson.build b/src/meson.build
index 6b537363..3ff36b5f 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -97,7 +97,6 @@ executable(meson.project_name(),
     gtkmm,
     atkmm,
     libgtop,
-    libhandy,
     libsystemd,
     libwnck,
   ],
diff --git a/src/prefsdialog.cpp b/src/prefsdialog.cpp
index 39ca3842..5cb9dc0e 100644
--- a/src/prefsdialog.cpp
+++ b/src/prefsdialog.cpp
@@ -14,15 +14,16 @@
 #include "systemd.h"
 #include "util.h"
 
-static HdyPreferencesWindow *prefs_dialog = NULL;
+static GtkDialog *prefs_dialog = NULL;
 
-static gboolean
-prefs_dialog_delete_event (GtkWidget *widget, GdkEvent *event, gpointer data)
+static void
+prefs_dialog_button_pressed (GtkDialog *dialog, gint id, gpointer data)
 {
+    gtk_widget_destroy (GTK_WIDGET (dialog));
     prefs_dialog = NULL;
-    return FALSE;
 }
 
+
 class SpinButtonUpdater
 {
 public:
@@ -228,10 +229,11 @@ create_preferences_dialog (GsmApplication *app)
     static SBU disks_interval_updater("disks-interval");
     static ScaleUpdater graph_points_updater("graph-data-points");
 
+    GtkNotebook *notebook;
     GtkAdjustment *adjustment;
     GtkSpinButton *spin_button;
-    GtkSwitch *check_switch;
-    GtkSwitch *smooth_switch;
+    GtkCheckButton *check_button;
+    GtkCheckButton *smooth_button;
     GtkBuilder *builder;
     gfloat update;
 
@@ -241,7 +243,9 @@ create_preferences_dialog (GsmApplication *app)
     builder = gtk_builder_new();
     gtk_builder_add_from_resource (builder, "/org/gnome/gnome-system-monitor/data/preferences.ui", NULL);
 
-    prefs_dialog = HDY_PREFERENCES_WINDOW (gtk_builder_get_object (builder, "preferences_dialog"));
+    prefs_dialog = GTK_DIALOG (gtk_builder_get_object (builder, "preferences_dialog"));
+
+    notebook = GTK_NOTEBOOK (gtk_builder_get_object (builder, "notebook"));
 
     spin_button = GTK_SPIN_BUTTON (gtk_builder_get_object (builder, "processes_interval_spinner"));
 
@@ -257,42 +261,42 @@ create_preferences_dialog (GsmApplication *app)
     g_signal_connect (G_OBJECT (spin_button), "focus_out_event",
                       G_CALLBACK (SBU::callback), &interval_updater);
 
-    smooth_switch = GTK_SWITCH (gtk_builder_get_object (builder, "smooth_switch"));
-    g_settings_bind(app->settings->gobj (), SmoothRefresh::KEY.c_str(), smooth_switch, "active", G_SETTINGS_BIND_DEFAULT);
+    smooth_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "smooth_button"));
+    g_settings_bind(app->settings->gobj (), SmoothRefresh::KEY.c_str(), smooth_button, "active", G_SETTINGS_BIND_DEFAULT);
 
-    check_switch = GTK_SWITCH (gtk_builder_get_object (builder, "check_switch"));
+    check_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "check_button"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_SHOW_KILL_DIALOG,
-                     check_switch, "active",
+                     check_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *solaris_switch = GTK_SWITCH (gtk_builder_get_object (builder, "solaris_switch"));
+    GtkCheckButton *solaris_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "solaris_button"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_SOLARIS_MODE,
-                     solaris_switch, "active",
+                     solaris_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *proc_mem_in_iec_switch = GTK_SWITCH (gtk_builder_get_object (builder, "proc_mem_in_iec_switch"));
+    GtkCheckButton *proc_mem_in_iec_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "proc_mem_in_iec_button"));
     g_settings_bind(app->settings->gobj (), GSM_SETTING_PROCESS_MEMORY_IN_IEC,
-                    proc_mem_in_iec_switch, "active",
+                    proc_mem_in_iec_button, "active",
                     G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *logarithmic_scale_switch = GTK_SWITCH (gtk_builder_get_object (builder, "logarithmic_scale_switch"));
+    GtkCheckButton *logarithmic_scale_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "logarithmic_scale_button"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_LOGARITHMIC_SCALE,
-                     logarithmic_scale_switch, "active",
+                     logarithmic_scale_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *draw_stacked_switch = GTK_SWITCH (gtk_builder_get_object (builder, "draw_stacked_switch"));
+    GtkCheckButton *draw_stacked_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "draw_stacked_button"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_DRAW_STACKED,
-                     draw_stacked_switch, "active",
+                     draw_stacked_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *draw_smooth_switch = GTK_SWITCH (gtk_builder_get_object (builder, "draw_smooth_switch"));
+    GtkCheckButton *draw_smooth_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "draw_smooth_button"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_DRAW_SMOOTH,
-                     draw_smooth_switch, "active",
+                     draw_smooth_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *res_mem_in_iec_switch = GTK_SWITCH (gtk_builder_get_object (builder, "res_mem_in_iec_switch"));
+    GtkCheckButton *res_mem_in_iec_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "res_mem_in_iec_button"));
     g_settings_bind(app->settings->gobj (), GSM_SETTING_RESOURCES_MEMORY_IN_IEC,
-                    res_mem_in_iec_switch, "active",
+                    res_mem_in_iec_button, "active",
                     G_SETTINGS_BIND_DEFAULT);
 
     create_field_page (builder, GTK_TREE_VIEW (app->tree), "proctree");
@@ -315,21 +319,25 @@ create_preferences_dialog (GsmApplication *app)
                       G_CALLBACK(ScaleUpdater::callback),
                       &graph_points_updater);
 
-    GtkSwitch *bits_switch = GTK_SWITCH (gtk_builder_get_object (builder, "bits_switch"));
+    GtkCheckButton *bits_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "bits_button"));
     g_settings_bind(app->settings->gobj (), GSM_SETTING_NETWORK_IN_BITS,
-                    bits_switch, "active",
+                    bits_button, "active",
                     G_SETTINGS_BIND_DEFAULT);
 
-    GtkSwitch *bits_unit_switch = GTK_SWITCH (gtk_builder_get_object (builder, "bits_unit_switch"));
+    GtkCheckButton *bits_unit_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "bits_unit_button"));
     g_settings_bind(app->settings->gobj (), GSM_SETTING_NETWORK_TOTAL_UNIT,
-                    bits_unit_switch, "active",
+                    bits_unit_button, "active",
                     G_SETTINGS_BIND_DEFAULT);
+    gtk_builder_add_callback_symbol (builder, "on_bits_unit_button_toggled",
+                    G_CALLBACK (on_bits_unit_button_toggled));
 
-    GtkSwitch *bits_total_switch = GTK_SWITCH (gtk_builder_get_object (builder, "bits_total_switch"));
+    GtkCheckButton *bits_total_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "bits_total_button"));
     g_settings_bind(app->settings->gobj (), GSM_SETTING_NETWORK_TOTAL_IN_BITS,
-                    bits_total_switch, "active",
+                    bits_total_button, "active",
                     G_SETTINGS_BIND_DEFAULT);
 
+    gtk_widget_set_sensitive((GtkWidget *)bits_total_button, gtk_toggle_button_get_active ((GtkToggleButton *)bits_unit_button));
+
     update = (gfloat) app->config.disks_update_interval;
     spin_button = GTK_SPIN_BUTTON (gtk_builder_get_object (builder, "devices_interval_spinner"));
     adjustment = gtk_spin_button_get_adjustment (spin_button);
@@ -340,22 +348,33 @@ create_preferences_dialog (GsmApplication *app)
                       &disks_interval_updater);
 
 
-    check_switch = GTK_SWITCH (gtk_builder_get_object (builder, "all_devices_check"));
+    check_button = GTK_CHECK_BUTTON (gtk_builder_get_object (builder, "all_devices_check"));
     g_settings_bind (app->settings->gobj (), GSM_SETTING_SHOW_ALL_FS,
-                     check_switch, "active",
+                     check_button, "active",
                      G_SETTINGS_BIND_DEFAULT);
 
     create_field_page (builder, GTK_TREE_VIEW (app->disk_list), "disktreenew");
 
     gtk_window_set_transient_for (GTK_WINDOW (prefs_dialog), GTK_WINDOW (GsmApplication::get()->main_window));
-    gtk_window_set_modal (GTK_WINDOW (prefs_dialog), TRUE);
 
     gtk_widget_show_all (GTK_WIDGET (prefs_dialog));
-    g_signal_connect (G_OBJECT (prefs_dialog), "delete-event",
-                      G_CALLBACK (prefs_dialog_delete_event), NULL);
+    g_signal_connect (G_OBJECT (prefs_dialog), "response",
+                      G_CALLBACK (prefs_dialog_button_pressed), app);
 
-    gtk_window_present (GTK_WINDOW (prefs_dialog));
+    auto current_tab = app->settings->get_string(GSM_SETTING_CURRENT_TAB);
+    if (current_tab == "processes")
+        gtk_notebook_set_current_page(GTK_NOTEBOOK(notebook), 0);
+    else if (current_tab == "resources")
+        gtk_notebook_set_current_page(GTK_NOTEBOOK(notebook), 1);
+    else if (current_tab == "disks")
+        gtk_notebook_set_current_page(GTK_NOTEBOOK(notebook), 2);
 
     gtk_builder_connect_signals (builder, NULL);
     g_object_unref (G_OBJECT (builder));
 }
+
+void
+on_bits_unit_button_toggled (GtkToggleButton *togglebutton, gpointer bits_total_button)
+{
+    gtk_widget_set_sensitive((GtkWidget *)bits_total_button, gtk_toggle_button_get_active ((GtkToggleButton *)togglebutton));
+}
-- 
2.30.2

